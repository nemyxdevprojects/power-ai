<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Power AI</title>
<style>
body { font-family: 'Segoe UI', sans-serif; background:#0e0e0e; color:#fff; display:flex; justify-content:center; align-items:center; height:100vh; }
#chatBox { width:90%; max-width:600px; height:80%; display:flex; flex-direction:column; border-radius:12px; background:#1a1a1a; overflow:hidden; box-shadow:0 0 20px rgba(0,0,0,0.7);}
#messages { flex:1; padding:12px; overflow-y:auto; display:flex; flex-direction:column; gap:8px;}
.msg { padding:10px 14px; border-radius:14px; max-width:75%; word-wrap:break-word; }
.user { background:#2575fc; align-self:flex-start; color:#fff; }
.admin { background:#333; align-self:flex-end; color:#fff; }
#inputZone { display:flex; gap:8px; padding:10px; background:#121212; }
#inputZone input { flex:1; padding:12px; border-radius:10px; border:none; background:#222; color:#fff; }
#inputZone button { padding:12px 16px; border-radius:10px; border:none; background:linear-gradient(90deg,#6a11cb,#2575fc); color:#fff; font-weight:bold; cursor:pointer; }
#inputZone button:active { transform:translateY(1px);}
</style>
</head>
<body>

<div id="chatBox">
  <div id="messages"></div>
  <div id="inputZone">
    <input id="msgInput" type="text" placeholder="Écris un message..." />
    <button id="sendBtn">Envoyer</button>
  </div>
</div>

<script>
let ws;
let userId;
let convName = prompt("Nom de ta conversation :", "Ma Conversation") || "Ma Conversation";

function initWS(){
  const base = window.location.protocol==='https:'?'wss':'ws';
  ws = new WebSocket(`${base}://${window.location.host}`);
  ws.onopen = ()=> {
    ws.send(JSON.stringify({type:'set_name', name:convName}));
  };

  ws.onmessage = (ev)=>{
    let data;
    try{ data = JSON.parse(ev.data); }catch(e){ return; }
    if(data.type==='init'){
      userId = data.userId;
      (data.messages||[]).forEach(m=>addMessage(m.sender, m.text));
    }
    else if(data.type==='admin'){
      addMessage('admin', data.text);
    }
    else if(data.type==='session_deleted'){
      alert("Ta session a été terminée par l'admin. Actualise la page.");
    }
  };
}

function addMessage(sender, text){
  const div = document.createElement('div');
  div.className = 'msg ' + sender;
  div.textContent = text;
  document.getElementById('messages').appendChild(div);
  document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
}

document.getElementById('sendBtn').onclick = sendMessage;
document.getElementById('msgInput').addEventListener('keypress', e=>{ if(e.key==='Enter') sendMessage(); });

function sendMessage(){
  const txt = document.getElementById('msgInput').value.trim();
  if(!txt) return;
  addMessage('user', txt);
  ws.send(JSON.stringify({type:'user_message', text:txt}));
  document.getElementById('msgInput').value='';
}

initWS();
</script>

</body>
</html>
