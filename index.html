<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Power AI</title>
<style>
body { font-family:'Segoe UI',sans-serif; background:#0e0e0e; color:#fff; display:flex; justify-content:center; align-items:center; height:100vh; }
#chatBox { width:90%; max-width:600px; height:80%; display:flex; flex-direction:column; border-radius:12px; background:#1a1a1a; overflow:hidden; box-shadow:0 0 20px rgba(0,0,0,0.7);}
#messages { flex:1; padding:12px; overflow-y:auto; display:flex; flex-direction:column; gap:8px;}
.msg { padding:10px 14px; border-radius:14px; max-width:75%; word-wrap:break-word; }
.user { background:#2575fc; align-self:flex-start; color:#fff; }
.admin { background:#333; align-self:flex-end; color:#fff; }
#inputZone{display:flex;gap:8px;padding:10px;background:#121212;}
#inputZone input{flex:1;padding:12px;border-radius:10px;border:none;background:#222;color:#fff;}
#inputZone button{padding:12px 16px;border-radius:10px;border:none;background:linear-gradient(90deg,#6a11cb,#2575fc); color:#fff;font-weight:bold;cursor:pointer;}
#inputZone button:active{transform:translateY(1px);}
#nameModal {position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);display:flex;justify-content:center;align-items:center;z-index:1000;}
#nameModal div {background:#1a1a1a;padding:24px;border-radius:12px;text-align:center;width:300px;}
#nameModal input {width:100%;padding:10px;margin:12px 0;border-radius:8px;border:none;background:#222;color:#fff;}
#nameModal button {padding:10px 16px;border-radius:8px;border:none;background:linear-gradient(90deg,#6a11cb,#2575fc);color:#fff;cursor:pointer;}
</style>
</head>
<body>

<div id="chatBox">
  <div id="messages"></div>
  <div id="inputZone">
    <input id="msgInput" type="text" placeholder="Écris un message..." />
    <button id="sendBtn">Envoyer</button>
  </div>
</div>

<!-- Popup pour nommer la conversation -->
<div id="nameModal">
  <div>
    <h2>Nom de la conversation</h2>
    <input id="convNameInput" type="text" placeholder="Ex: Ma Discussion">
    <button id="convNameBtn">Valider</button>
  </div>
</div>

<script>
let ws;
let userId;
const modal=document.getElementById('nameModal');
const nameInput=document.getElementById('convNameInput');
const nameBtn=document.getElementById('convNameBtn');

function initWS(){
  const base=window.location.protocol==='https:'?'wss':'ws';
  ws=new WebSocket(`${base}://${window.location.host}`);
  
  ws.onopen=()=>{};
  ws.onmessage=ev=>{
    let data;
    try{ data=JSON.parse(ev.data);}catch(e){ return;}
    if(data.type==='init'){
      userId=data.userId;
      (data.messages||[]).forEach(m=>addMessage(m.sender,m.text));
    }
    else if(data.type==='admin'){
      addMessage('admin',data.text);
    }
    else if(data.type==='session_deleted'){
      const msgDiv=document.createElement('div');
      msgDiv.style.background='#ff4b4b';
      msgDiv.style.padding='12px';
      msgDiv.style.borderRadius='12px';
      msgDiv.style.textAlign='center';
      msgDiv.textContent='Votre session a été terminée par l\'admin. Actualisez la page.';
      document.body.appendChild(msgDiv);
    }
  };
}

function addMessage(sender,text){
  const div=document.createElement('div');
  div.className='msg '+sender;
  div.textContent=text;
  document.getElementById('messages').appendChild(div);
  document.getElementById('messages').scrollTop=document.getElementById('messages').scrollHeight;
}

document.getElementById('sendBtn').onclick=sendMessage;
document.getElementById('msgInput').addEventListener('keypress',e=>{if(e.key==='Enter')sendMessage();});

function sendMessage(){
  const txt=document.getElementById('msgInput').value.trim();
  if(!txt) return;
  addMessage('user',txt);
  ws.send(JSON.stringify({type:'user_message',text:txt}));
  document.getElementById('msgInput').value='';
}

// Modal pour nommer la conversation
nameBtn.onclick=()=>{
  const name=nameInput.value.trim()||'Sans Nom';
  ws.send(JSON.stringify({type:'set_name',name}));
  modal.style.display='none';
};
nameInput.addEventListener('keypress',e=>{if(e.key==='Enter') nameBtn.click();});

initWS();
</script>
</body>
</html>
